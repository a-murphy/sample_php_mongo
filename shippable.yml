language: php

php: 
  - 5.4
  - 5.5
  - 5.6
  - 7.0
  - hhvm
  
services:
  - rabbitmq
  
build:
  ci:
    -  if [ "$SHIPPABLE_PHP_VERSION" == 5.6 ]; then
        /usr/local/bin/phpenv-install 5.6.18;
        'eval "$(phpenv init -)"';
        $HOME/.phpenv/bin/phpenv global 5.6.18;
        php --version;
        curl -s http://getcomposer.org/installer | php;
        chmod +x composer.phar;
        mv composer.phar $HOME/.phpenv/versions/5.6.18/bin/composer;
      fi;
    - composer self-update
    - composer install --no-progress --no-interaction --prefer-source
    - wget https://xdebug.org/files/xdebug-2.4.0.tgz
    - tar -xvzf xdebug-2.4.0.tgz
    - cd xdebug-2.4.0
    - phpize
    - ./configure
    - make
    - if [ "$SHIPPABLE_PHP_VERSION" == 5.4 ]; then cp modules/xdebug.so /root/.phpenv/versions/5.4/lib/php/extensions/no-debug-non-zts-20100525; fi
    - if [ "$SHIPPABLE_PHP_VERSION" == 5.5 ]; then cp modules/xdebug.so /root/.phpenv/versions/5.5/lib/php/extensions/no-debug-non-zts-20121212; fi
    - if [ "$SHIPPABLE_PHP_VERSION" == 5.6 ]; then cp modules/xdebug.so /root/.phpenv/versions/5.6/lib/php/extensions/no-debug-non-zts-20131226; fi
    - if [ "$SHIPPABLE_PHP_VERSION" == 7.0 ]; then cp modules/xdebug.so /root/.phpenv/versions/7.0/lib/php/extensions/no-debug-non-zts-20151012; fi
    - cd ..
    - mkdir -p shippable/testresults
    - mkdir -p shippable/codecoverage
    - vendor/phpunit/phpunit/phpunit  --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage -c phpunit.xml
